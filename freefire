<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora XP Free Fire</title>

<style>
body {
  background:#000;
  font-family: Arial, sans-serif;
  color:#fff;
  padding:20px;
}

.box {
  max-width:480px;
  margin:auto;
  background:#0d0d0d;
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 20px rgba(30,64,255,.5);
}

h2 {
  text-align:center;
  color:#1e40ff;
}

button, input, select {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #1e40ff;
  background:#000;
  color:#fff;
  font-size:16px;
}

button {
  background:#1e40ff;
  cursor:pointer;
}

.toggle {
  display:flex;
  gap:10px;
}

.toggle button.active {
  background:#00c3ff;
}

.info, .resultado {
  margin-top:15px;
  padding:15px;
  background:#090909;
  border-left:4px solid #1e40ff;
  border-radius:8px;
}

#loading {
  display:none;
  margin-top:15px;
  text-align:center;
}

.loader {
  border:5px solid #333;
  border-top:5px solid #1e40ff;
  border-radius:50%;
  width:50px;
  height:50px;
  animation:spin 1s linear infinite;
  margin:auto;
}

@keyframes spin {
  to { transform:rotate(360deg); }
}

.hidden {
  display:none;
}
</style>
</head>

<body>

<div class="box">
<h2>Calculadora de XP Free Fire</h2>

<div class="toggle">
  <button id="btnApi" class="active" onclick="modoAPI()">UID</button>
  <button id="btnManual" onclick="modoManual()">XP</button>
</div>

<!-- MODO API -->
<div id="api">
  <input id="uid" placeholder="UID do jogador">
  <select id="server">
    <option value="ind">IND</option>
    <option value="br">BR</option>
  </select>
  <button onclick="buscarJogador()">Buscar jogador</button>
</div>

<!-- MODO MANUAL -->
<div id="manual" class="hidden">
  <input id="xpManual" placeholder="Digite o XP total">
</div>

<div id="loading">
  <div class="loader"></div>
  <p>Identificando usuário..</p>
</div>

<div id="playerInfo" class="info hidden"></div>

<label id="labelNivel" class="hidden">Nível desejado:</label>
<select id="nivelDesejado" class="hidden"></select>

<div id="resultado" class="resultado hidden"></div>
</div>

<script>
const tabelaXP = {
1: 0, 2: 48, 3: 202, 4: 544, 5: 1012, 6: 1844, 7: 2792, 8: 3800, 9: 4870, 10: 6004,  
    11: 7192, 12: 8448, 13: 9760, 14: 11140, 15: 12566, 16: 14060, 17: 15610, 18: 17224,  
    19: 18902, 20: 20632, 21: 22442, 22: 24278, 23: 26192, 24: 28166, 25: 30200,  
    26: 32294, 27: 34448, 28: 37804, 29: 41274, 30: 44870, 31: 48582, 32: 53394,  
    33: 58566, 34: 64096, 35: 69994, 36: 76460, 37: 83606, 38: 91128, 39: 99322,  
    40: 108092, 41: 120144, 42: 133266, 43: 147472, 44: 162760, 45: 179126,  
    46: 196572, 47: 215386, 48: 235516, 49: 257010, 50: 279860, 51: 304056,  
    52: 348318, 53: 394982, 54: 444044, 55: 495508, 56: 549364, 57: 633756,  
    58: 721744, 59: 813336, 60: 908522, 61: 1041438, 62: 1180352, 63: 1325262,  
    64: 1476184, 65: 1634300, 66: 1840946, 67: 2056594, 68: 2281242, 69: 2514880,  
    70: 2757530, 71: 3059506, 72: 3372284, 73: 3699656, 74: 4041030, 75: 4397002,  
    76: 4829104, 77: 5282204, 78: 5756304, 79: 6251400, 80: 6767502, 81: 7381324,  
    82: 8043154, 83: 8752982, 84: 9510808, 85: 10316638, 86: 11077190, 87: 12297148,  
    88: 13360304, 89: 14482858, 90: 15659418, 91: 17026708, 92: 18453998,  
    93: 19941280, 94: 21488570, 95: 23095858, 96: 24763138, 97: 26490428,  
    98: 28277208, 99: 30124998, 100: 32032284  
};

let xpJogador = 0;
let nivelAtual = 1;

/* UTIL */
function detectarNivel(xp){
  let n=1;
  for(let i in tabelaXP){
    if(xp>=tabelaXP[i]) n=parseInt(i);
  }
  return n;
}

function limpar(){
  xpJogador=0;
  nivelAtual=1;
  playerInfo.innerHTML="";
  playerInfo.classList.add("hidden");
  resultado.classList.add("hidden");
  nivelDesejado.classList.add("hidden");
  labelNivel.classList.add("hidden");
  loading.style.display="none";
}

/* NÍVEIS */
function popularNiveis(){
  nivelDesejado.innerHTML="";
  for(let i=nivelAtual+1;i<=100;i++){
    nivelDesejado.innerHTML+=`<option value="${i}">Level ${i}</option>`;
  }
  labelNivel.classList.remove("hidden");
  nivelDesejado.classList.remove("hidden");
  nivelDesejado.onchange=e=>calcular(e.target.value);
}

function calcular(nivel){
  let falta=tabelaXP[nivel]-xpJogador;
  if(falta<0)falta=0;
  resultado.classList.remove("hidden");
  resultado.innerHTML=`
  <b>Nível desejado:</b> ${nivel}<br>
  <b>XP faltante:</b><br>
  ${falta.toLocaleString("pt-BR")} XP`;
}

/* API */
async function buscarJogador(){
  limpar();
  let id=uid.value.replace(/\D/g,"");
  if(!id) return alert("Digite o UID");
  loading.style.display="block";

  try{
    let res=await fetch(`https://freefire-api-six.vercel.app/get_player_personal_show?server=${server.value}&uid=${id}`);
    let data=await res.json();

    setTimeout(()=>{
      loading.style.display="none";
      let p=data.basicinfo;
      xpJogador=parseInt(p.exp);
      nivelAtual=detectarNivel(xpJogador);

      playerInfo.classList.remove("hidden");
      playerInfo.innerHTML=`
      <b>Nickname:</b> ${p.nickname}<br>
      <b>Região:</b> ${p.region}<br>
      <b>Level:</b> ${nivelAtual}<br>
      <b>XP:</b> ${xpJogador.toLocaleString("pt-BR")}
      `;

      popularNiveis();
      calcular(nivelAtual+1);
    },20);

  }catch{
    loading.style.display="none";
    alert("Erro ao buscar dados");
  }
}

/* MANUAL */
xpManual.addEventListener("input",e=>{
  limpar();
  let xp=e.target.value.replace(/\D/g,"");
  e.target.value=xp;
  if(!xp) return;

  xpJogador=parseInt(xp);
  nivelAtual=detectarNivel(xpJogador);

  playerInfo.classList.remove("hidden");
  playerInfo.innerHTML=`
  <b>Modo manual</b><br>
  <b>Level:</b> ${nivelAtual}<br>
  <b>XP:</b> ${xpJogador.toLocaleString("pt-BR")}
  `;

  popularNiveis();
  calcular(nivelAtual+1);
});

/* TOGGLE */
function modoAPI(){
  limpar();
  api.classList.remove("hidden");
  manual.classList.add("hidden");
  btnApi.classList.add("active");
  btnManual.classList.remove("active");
  uid.value="";
}

function modoManual(){
  limpar();
  manual.classList.remove("hidden");
  api.classList.add("hidden");
  btnManual.classList.add("active");
  btnApi.classList.remove("active");
  xpManual.value="";
}
</script>

</body>
</html>
